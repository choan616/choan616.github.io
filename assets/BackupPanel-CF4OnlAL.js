const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D1XZtA4z.js","assets/vendor-ui-CGZmARxJ.js","assets/vendor-react-qkC6yhPU.js","assets/vendor-utils-BGkSQjfT.js","assets/vendor-db-CzqAUFpF.js","assets/index-M1U_o6Fo.css"])))=>i.map(i=>d[i]);
import{u as q,a as J,g as o,j as e,S as D,_ as p,s as K}from"./index-D1XZtA4z.js";import{r as f}from"./vendor-ui-CGZmARxJ.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-db-CzqAUFpF.js";import"./vendor-utils-BGkSQjfT.js";function ne({currentUser:n,onClose:v,onDataRestored:m,onAuthenticated:_}){const[E,R]=f.useState(!0),[O,$]=f.useState(!1),[b,S]=f.useState(null),[B,C]=f.useState([]),[j,l]=f.useState(!1),[T,k]=f.useState(0),[A,L]=f.useState(0),{showToast:r}=q(),{status:g,lastSyncTime:U,lastError:Z,triggerSync:I}=J();f.useEffect(()=>{const s=o.onAuthChange(async t=>{if($(t),t){const a=await o.getCurrentUser();S(a),y()}else S(null),C([])});return()=>s()},[n.userId]);async function G(){try{l(!0),await o.signIn();const s=await o.getCurrentUser();if(!s)throw new Error("Google ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const t="choan616@gmail.com,mywater22@gmail.com, waterchoan@gmail.com".split(",").map(h=>h.trim()).filter(Boolean);if(t.length>0&&!t.includes(s.email))throw await o.signOut(),new Error(`ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤: ${s.email}`);const{createUser:a,getUser:i}=await p(async()=>{const{createUser:h,getUser:x}=await import("./index-D1XZtA4z.js").then(N=>N.e);return{createUser:h,getUser:x}},__vite__mapDeps([0,1,2,3,4,5])),c=await a({email:s.email,name:s.name},{imageUrl:s.imageUrl}),d=await i(c);_&&_(d),r("ë¡œê·¸ì¸ ì„±ê³µ!","success")}catch(s){console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:",s),r("ë¡œê·¸ì¸ ì‹¤íŒ¨","error")}finally{l(!1)}}async function z(){try{await o.signOut(),$(!1),S(null),C([]),r("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤","info")}catch(s){console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:",s)}}async function y(){try{l(!0);let s=await o.listBackupFiles();s.sort((t,a)=>new Date(a.createdTime)-new Date(t.createdTime)),C(s)}catch(s){console.error("íŒŒì¼ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:",s),r("ë°±ì—… íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤","error")}finally{l(!1)}}async function V(){try{l(!0),k(0),r("ë°±ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");let s;const{exportUserDataAsZip:t}=await p(async()=>{const{exportUserDataAsZip:u}=await import("./index-D1XZtA4z.js").then(P=>P.e);return{exportUserDataAsZip:u}},__vite__mapDeps([0,1,2,3,4,5]));try{if(s=await t(n.userId),console.log("ë°±ì—… ZIP íŒŒì¼ ìƒì„± ì™„ë£Œ. í¬ê¸°:",s.size),s.size<22){r("ë°±ì—…í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.","info"),l(!1);return}}catch(u){throw console.error("ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",u),new Error(`ë°ì´í„° ìƒì„± ì‹¤íŒ¨: ${u.message}`)}const{getLocalDataSummary:a}=await p(async()=>{const{getLocalDataSummary:u}=await import("./index-D1XZtA4z.js").then(P=>P.e);return{getLocalDataSummary:u}},__vite__mapDeps([0,1,2,3,4,5])),i=await a(n.userId),c=await s.arrayBuffer(),d=await crypto.subtle.digest("SHA-256",c),x=Array.from(new Uint8Array(d)).map(u=>u.toString(16).padStart(2,"0")).join(""),N={...i,contentHash:x},F=await o.syncToGoogleDrive(s,N,u=>k(u));k(100),r(`ë°±ì—… ì™„ë£Œ: ${F.file.name}`,"success"),await K.notifySyncSuccess(F),await y()}catch(s){console.error("ë°±ì—… ì˜¤ë¥˜:",s),r(`ë°±ì—… ì‹¤íŒ¨: ${s.message}`,"error")}finally{l(!1),k(0)}}async function M(s,t){if(confirm(`"${t}"ì„(ë¥¼) ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

í´ë¼ìš°ë“œì˜ ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`))try{l(!0),L(0),r("ë³µì›ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");const a=await o.restoreFromGoogleDrive(s);if(!a||!a.blob)throw new Error("Google Driveì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");const i=await a.blob.arrayBuffer(),{importUserData:c}=await p(async()=>{const{importUserData:d}=await import("./index-D1XZtA4z.js").then(h=>h.e);return{importUserData:d}},__vite__mapDeps([0,1,2,3,4,5]));await c(n.userId,i,!0),L(100),r("ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.","success"),(g===D.CONFLICT||m)&&(console.log("ì¶©ëŒ í•´ê²°(Pull) ë˜ëŠ” ë°ì´í„° ë³µì› í›„ ë™ê¸°í™” ìƒíƒœë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤."),I({silent:!0,isManual:!0})),setTimeout(()=>{w()},500)}catch(a){console.error("ë³µì› ì˜¤ë¥˜:",a),r(`ë³µì› ì‹¤íŒ¨: ${a.message}`,"error")}finally{l(!1),L(0)}}async function H(s,t){if(confirm(`"${t}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){l(!0);try{await o.deleteBackupFile(s),r("ë°±ì—… íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤","success"),await y()}catch(a){console.error("ì‚­ì œ ì˜¤ë¥˜:",a),r("ì‚­ì œ ì‹¤íŒ¨","error")}finally{l(!1)}}}async function X(){try{const{exportUserDataAsZip:s}=await p(async()=>{const{exportUserDataAsZip:c}=await import("./index-D1XZtA4z.js").then(d=>d.e);return{exportUserDataAsZip:c}},__vite__mapDeps([0,1,2,3,4,5])),t=await s(n.userId),a=URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`diary_backup_${n.email}_${new Date().toISOString().split("T")[0]}.zip`,i.click(),URL.revokeObjectURL(a),r("ZIP íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ","success")}catch(s){console.error("ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",s),r("ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨","error")}}async function Y(s){const t=s.target.files[0];if(t){if(!confirm(`'${t.name}' íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`)){s.target.value="";return}try{const{importUserData:a}=await p(async()=>{const{importUserData:c}=await import("./index-D1XZtA4z.js").then(d=>d.e);return{importUserData:c}},__vite__mapDeps([0,1,2,3,4,5])),i=await t.arrayBuffer();await a(n.userId,i,!0),r("ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.","success"),m&&m(),I&&I({silent:!1}),w()}catch(a){console.error("ZIP ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",a),r(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${a.message}`,"error")}s.target.value=""}}async function W(s){const t=s.target.files[0];if(t){if(!confirm(`'${t.name}' í…ìŠ¤íŠ¸ íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

íŒŒì¼ì˜ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì¼ê¸°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.`)){s.target.value="";return}try{const a=await t.text(),{parseTxtDiary:i}=await p(async()=>{const{parseTxtDiary:x}=await import("./txtDiaryParser-B3P80UsS.js");return{parseTxtDiary:x}},[]),c=i(a,n.userId);if(c.length===0){r("íŒŒì¼ì—ì„œ ìœ íš¨í•œ ì¼ê¸° ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.","warning");return}const{bulkAddEntries:d}=await p(async()=>{const{bulkAddEntries:x}=await import("./index-D1XZtA4z.js").then(N=>N.e);return{bulkAddEntries:x}},__vite__mapDeps([0,1,2,3,4,5])),h=await d(c);r(`${h}ê°œì˜ ì¼ê¸°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`,"success"),m&&m(),w()}catch(a){console.error("TXT ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",a),r(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${a.message}`,"error")}}}const w=()=>{R(!1),v&&v()};return E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"backup-panel-overlay",onClick:w}),e.jsxs("div",{className:"backup-panel",children:[e.jsxs("div",{className:"backup-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"ğŸ’¾ ë°±ì—… ë° ë™ê¸°í™”"}),e.jsxs("p",{className:"backup-user-info",children:["ì‚¬ìš©ì: ",n.name||n.email]})]}),e.jsx("button",{className:"close-btn",onClick:w,children:"âœ•"})]}),e.jsxs("div",{className:"backup-content",children:[e.jsx("section",{className:"backup-section",children:n.isGuest&&!O?e.jsxs("div",{className:"auth-section guest-prompt",children:[e.jsx("h3",{children:"â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”"}),e.jsx("p",{children:"Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ê³ , ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ì¼ê¸°ë¥¼ ë™ê¸°í™”í•˜ì„¸ìš”."}),e.jsx("button",{className:"btn btn-primary",onClick:G,disabled:j,children:"ğŸ” Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"â˜ï¸ Google Drive"}),O?e.jsxs("div",{className:"authenticated-section",children:[e.jsxs("div",{className:"user-info",children:[b&&e.jsxs(e.Fragment,{children:[b.imageUrl&&e.jsx("img",{src:b.imageUrl,alt:"í”„ë¡œí•„"}),e.jsxs("div",{children:[e.jsx("div",{className:"user-name",children:b.name}),e.jsx("div",{className:"user-email",children:b.email})]})]}),e.jsx("button",{className:"btn btn-small",onClick:z,children:"ë¡œê·¸ì•„ì›ƒ"})]}),e.jsxs("div",{className:"backup-actions",children:[e.jsx("button",{className:"btn btn-success",onClick:V,disabled:j,children:"ğŸ“¤ ì§€ê¸ˆ ë°±ì—…í•˜ê¸° (ìˆ˜ë™)"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>I({silent:!1,isManual:!0}).then(()=>{y()}).catch(s=>{console.error("ìˆ˜ë™ ë™ê¸°í™” ì‹¤íŒ¨:",s)}),disabled:g===D.SYNCING,children:g===D.SYNCING?"ğŸ”„ ë™ê¸°í™” ì¤‘...":"ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”"}),e.jsx("button",{className:"btn btn-secondary",onClick:y,disabled:j,children:"ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨"})]}),g===D.CONFLICT&&e.jsxs("div",{className:"sync-status-info conflict",children:[e.jsxs("div",{className:"conflict-header-info",children:[e.jsx("h4",{children:"âš ï¸ ë™ê¸°í™” ì¶©ëŒ"}),e.jsx("p",{children:Z||"ë‹¤ë¥¸ ê¸°ê¸°ì™€ ë°ì´í„° ì¶©ëŒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})]}),e.jsx("button",{className:"btn btn-danger",onClick:()=>r("ì¶©ëŒ í•´ê²° ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ìˆìŠµë‹ˆë‹¤."),children:"ì¶©ëŒ í•´ê²°í•˜ê¸°"})]}),e.jsxs("div",{className:"sync-status-info",children:[e.jsx("strong",{children:"ë™ê¸°í™” ìƒíƒœ:"})," ",e.jsx("span",{className:`status-${g.toLowerCase()}`,children:g})," ",e.jsx("br",{}),e.jsx("strong",{children:"ë§ˆì§€ë§‰ ë™ê¸°í™”:"})," ",U?new Date(U).toLocaleString():"ì—†ìŒ"]}),T>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${T}%`}}),e.jsxs("span",{className:"progress-text",children:[Math.round(T),"%"]})]}),A>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill restore",style:{width:`${A}%`}}),e.jsxs("span",{className:"progress-text",children:["ë³µì› ì¤‘... ",Math.round(A),"%"]})]}),B.length>0&&e.jsxs("div",{className:"backup-files",children:[e.jsx("h4",{children:"ë°±ì—… íŒŒì¼ ëª©ë¡"}),e.jsx("div",{className:"file-list",children:B.map((s,t)=>e.jsx(Q,{file:s,isLatest:t===0,isLoading:j,onRestore:M,onDelete:H},s.id))})]})]}):e.jsxs("div",{className:"auth-section",children:[e.jsx("p",{children:"Google Driveì— ë¡œê·¸ì¸í•˜ì—¬ ì¼ê¸°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ì„¸ìš”."}),e.jsx("button",{className:"btn btn-primary",onClick:G,disabled:j,children:"ğŸ” Google ë¡œê·¸ì¸"})]})]})}),e.jsxs("section",{className:"backup-section",children:[e.jsx("h3",{children:"ğŸ’¾ ìˆ˜ë™ ë°±ì—… (ë¡œì»¬)"}),e.jsx("p",{children:"ì¼ê¸° ë°ì´í„°ë¥¼ ZIP íŒŒì¼ë¡œ ì»´í“¨í„°ì— ì €ì¥í•˜ê±°ë‚˜, ì €ì¥ëœ íŒŒì¼ì„ ë³µì›í•©ë‹ˆë‹¤."}),e.jsxs("div",{className:"manual-backup-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:X,children:"ğŸ“¥ ZIPìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°"}),e.jsxs("label",{className:"btn btn-secondary",children:["ğŸ“¤ ZIP ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".zip,application/zip",style:{display:"none"},onChange:Y})]}),e.jsxs("label",{className:"btn btn-secondary",children:["ğŸ“„ TXT ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".txt,text/plain",style:{display:"none"},onChange:W})]})]})]})]})]})]}):null}function Q({file:n,isLatest:v,isLoading:m,onRestore:_,onDelete:E}){return e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"file-info",children:[e.jsxs("div",{className:"file-main-text",children:[e.jsx("span",{className:"file-date",children:o.constructor.formatDate(n.createdTime)}),v&&e.jsx("span",{className:"latest-backup-badge",children:"ê°€ì¥ ìµœê·¼"})]}),e.jsxs("div",{className:"file-sub-text",children:[e.jsx("span",{className:"file-name",children:n.name})," Â· ",e.jsx("span",{className:"file-size",children:o.constructor.formatFileSize(n.size)})]})]}),e.jsxs("div",{className:"file-actions",children:[e.jsx("button",{className:"btn btn-small btn-primary",onClick:()=>_(n.id,n.name),disabled:m,children:"ë³µì›"}),e.jsx("button",{className:"btn btn-small btn-danger",onClick:()=>E(n.id,n.name),disabled:m,children:"ì‚­ì œ"})]})]})}export{ne as BackupPanel};
