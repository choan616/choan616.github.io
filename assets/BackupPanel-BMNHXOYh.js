const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-EOXgBHXE.js","assets/vendor-ui-CGZmARxJ.js","assets/vendor-react-qkC6yhPU.js","assets/vendor-utils-BGkSQjfT.js","assets/vendor-db-CzqAUFpF.js","assets/index-CSaKV4iK.css","assets/DropboxService-3la17Qkw.js"])))=>i.map(i=>d[i]);
import{_ as b,g as re,u as ie,a as ne,j as e,S as A}from"./index-EOXgBHXE.js";import{r as u}from"./vendor-ui-CGZmARxJ.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-db-CzqAUFpF.js";import"./vendor-utils-BGkSQjfT.js";let O=null,F=null;class R{static async getService(m){switch(m){case"google":{if(!O){const{googleDriveService:c}=await b(async()=>{const{googleDriveService:h}=await import("./index-EOXgBHXE.js").then(j=>j.G);return{googleDriveService:h}},__vite__mapDeps([0,1,2,3,4,5]));O=c}return O}case"dropbox":{if(!F){const{dropboxService:c}=await b(async()=>{const{dropboxService:h}=await import("./DropboxService-3la17Qkw.js");return{dropboxService:h}},__vite__mapDeps([6,0,1,2,3,4,5]));F=c}return F}default:throw new Error(`Unknown cloud storage provider: ${m}`)}}static getAvailableProviders(){return[{value:"google",label:"Google Drive",icon:"â˜ï¸"},{value:"dropbox",label:"Dropbox",icon:"ğŸ“¦"}]}}function fe({currentUser:t,onClose:m,onDataRestored:c,onAuthenticated:h}){const[j,H]=u.useState(!0),[S,K]=u.useState(()=>localStorage.getItem("preferredCloudProvider")||"google"),[n,U]=u.useState(re),[Z,P]=u.useState(!1),[w,I]=u.useState(null),[z,E]=u.useState([]),[N,l]=u.useState(!1),[L,C]=u.useState(0),[T,B]=u.useState(0),{showToast:i}=ie(),{status:v,lastSyncTime:M,lastError:X,triggerSync:D,notifySyncSuccess:Y}=ne(),W=async s=>{try{l(!0),K(s),localStorage.setItem("preferredCloudProvider",s);const a=await R.getService(s);U(a),P(!1),I(null),E([])}catch(a){console.error("Failed to switch provider:",a),i("ì €ì¥ì†Œ ì „í™˜ ì‹¤íŒ¨","error")}finally{l(!1)}},y=u.useCallback(async()=>{try{l(!0);let s=await n.listBackupFiles();s.sort((a,r)=>new Date(r.createdTime)-new Date(a.createdTime)),E(s)}catch(s){console.error("íŒŒì¼ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:",s),i("ë°±ì—… íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤","error")}finally{l(!1)}},[n,i]);u.useEffect(()=>{(async()=>{const a=await R.getService(S);U(a)})()},[S]),u.useEffect(()=>{if(!n)return;const s=n.onAuthChange(async a=>{if(P(a),a){const r=await n.getCurrentUser();I(r),y()}else I(null),E([])});return!n.isAuthenticated&&t?.email&&!t.isGuest&&n.restoreSession(t.email).then(a=>{console.log(a?`Silent sign-in successful for ${n.providerName}`:`Silent sign-in failed for ${n.providerName}`)}),()=>s()},[n,t.userId,t.email,t.isGuest,y]);async function V(){try{l(!0),await n.signIn();const s=await n.getCurrentUser();if(!s)throw new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");if(S==="google"){const a="choan616@gmail.com,mywater22@gmail.com, waterchoan@gmail.com".split(",").map(g=>g.trim()).filter(Boolean);if(a.length>0&&!a.includes(s.email))throw await n.signOut(),new Error(`ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤: ${s.email}`);const{createUser:r,getUser:o}=await b(async()=>{const{createUser:g,getUser:x}=await import("./index-EOXgBHXE.js").then(_=>_.b);return{createUser:g,getUser:x}},__vite__mapDeps([0,1,2,3,4,5])),d=await r({email:s.email,name:s.name},{imageUrl:s.imageUrl}),p=await o(d);h&&h(p)}i("ë¡œê·¸ì¸ ì„±ê³µ!","success")}catch(s){console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:",s),i("ë¡œê·¸ì¸ ì‹¤íŒ¨","error")}finally{l(!1)}}async function q(){try{await n.signOut(),P(!1),I(null),E([]),i("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤","info")}catch(s){console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:",s)}}async function J(){try{l(!0),C(0),i("ë°±ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");let s;const{exportUserDataAsZip:a}=await b(async()=>{const{exportUserDataAsZip:f}=await import("./index-EOXgBHXE.js").then($=>$.b);return{exportUserDataAsZip:f}},__vite__mapDeps([0,1,2,3,4,5]));try{if(s=await a(t.userId),console.log("ë°±ì—… ZIP íŒŒì¼ ìƒì„± ì™„ë£Œ. í¬ê¸°:",s.size),s.size<22){i("ë°±ì—…í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.","info"),l(!1);return}}catch(f){throw console.error("ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",f),new Error(`ë°ì´í„° ìƒì„± ì‹¤íŒ¨: ${f.message}`)}const{getLocalDataSummary:r}=await b(async()=>{const{getLocalDataSummary:f}=await import("./index-EOXgBHXE.js").then($=>$.b);return{getLocalDataSummary:f}},__vite__mapDeps([0,1,2,3,4,5])),o=await r(t.userId),d=await s.arrayBuffer(),p=await crypto.subtle.digest("SHA-256",d),x=Array.from(new Uint8Array(p)).map(f=>f.toString(16).padStart(2,"0")).join(""),_={...o,contentHash:x},G=await n.uploadBackup(s,_,f=>C(f));C(100),i(`ë°±ì—… ì™„ë£Œ: ${G.file.name}`,"success"),await Y(G),await y()}catch(s){console.error("ë°±ì—… ì˜¤ë¥˜:",s),i(`ë°±ì—… ì‹¤íŒ¨: ${s.message}`,"error")}finally{l(!1),C(0)}}async function Q(s,a){if(confirm(`"${a}"ì„(ë¥¼) ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

í´ë¼ìš°ë“œì˜ ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`))try{l(!0),B(0),i("ë³µì›ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");const r=await n.downloadBackup(s);if(!r||!r.blob)throw new Error("Google Driveì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");const o=await r.blob.arrayBuffer(),{importUserData:d}=await b(async()=>{const{importUserData:p}=await import("./index-EOXgBHXE.js").then(g=>g.b);return{importUserData:p}},__vite__mapDeps([0,1,2,3,4,5]));await d(t.userId,o,!0),B(100),i("ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.","success"),(v===A.CONFLICT||c)&&(console.log("ì¶©ëŒ í•´ê²°(Pull) ë˜ëŠ” ë°ì´í„° ë³µì› í›„ ë™ê¸°í™” ìƒíƒœë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤."),D({silent:!0,isManual:!0})),setTimeout(()=>{k()},500)}catch(r){console.error("ë³µì› ì˜¤ë¥˜:",r),i(`ë³µì› ì‹¤íŒ¨: ${r.message}`,"error")}finally{l(!1),B(0)}}async function ee(s,a){if(confirm(`"${a}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){l(!0);try{await n.deleteBackup(s),i("ë°±ì—… íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤","success"),await y()}catch(r){console.error("ì‚­ì œ ì˜¤ë¥˜:",r),i("ì‚­ì œ ì‹¤íŒ¨","error")}finally{l(!1)}}}async function se(){try{const{exportUserDataAsZip:s}=await b(async()=>{const{exportUserDataAsZip:d}=await import("./index-EOXgBHXE.js").then(p=>p.b);return{exportUserDataAsZip:d}},__vite__mapDeps([0,1,2,3,4,5])),a=await s(t.userId),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=`diary_backup_${t.email}_${new Date().toISOString().split("T")[0]}.zip`,o.click(),URL.revokeObjectURL(r),i("ZIP íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ","success")}catch(s){console.error("ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",s),i("ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨","error")}}async function ae(s){const a=s.target.files[0];if(a){if(!confirm(`'${a.name}' íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`)){s.target.value="";return}try{const{importUserData:r}=await b(async()=>{const{importUserData:d}=await import("./index-EOXgBHXE.js").then(p=>p.b);return{importUserData:d}},__vite__mapDeps([0,1,2,3,4,5])),o=await a.arrayBuffer();await r(t.userId,o,!0),i("ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.","success"),c&&c(),D&&D({silent:!1}),k()}catch(r){console.error("ZIP ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",r),i(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${r.message}`,"error")}s.target.value=""}}async function te(s){const a=s.target.files[0];if(a){if(!confirm(`'${a.name}' í…ìŠ¤íŠ¸ íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

íŒŒì¼ì˜ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì¼ê¸°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.`)){s.target.value="";return}try{const r=await a.text(),{parseTxtDiary:o}=await b(async()=>{const{parseTxtDiary:x}=await import("./txtDiaryParser-B3P80UsS.js");return{parseTxtDiary:x}},[]),d=o(r,t.userId);if(d.length===0){i("íŒŒì¼ì—ì„œ ìœ íš¨í•œ ì¼ê¸° ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.","warning");return}const{bulkAddEntries:p}=await b(async()=>{const{bulkAddEntries:x}=await import("./index-EOXgBHXE.js").then(_=>_.b);return{bulkAddEntries:x}},__vite__mapDeps([0,1,2,3,4,5])),g=await p(d);i(`${g}ê°œì˜ ì¼ê¸°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`,"success"),c&&c(),k()}catch(r){console.error("TXT ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",r),i(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${r.message}`,"error")}}}const k=()=>{H(!1),m&&m()};return j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"backup-panel-overlay",onClick:k}),e.jsxs("div",{className:"backup-panel",children:[e.jsxs("div",{className:"backup-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"ğŸ’¾ ë°±ì—… ë° ë™ê¸°í™”"}),e.jsxs("p",{className:"backup-user-info",children:["ì‚¬ìš©ì: ",t.name||t.email]})]}),e.jsx("button",{className:"close-btn clickable",onClick:k,children:"âœ•"})]}),e.jsxs("div",{className:"backup-content",children:[e.jsxs("div",{className:"provider-selector",children:[e.jsx("label",{htmlFor:"cloud-provider",children:"ë°±ì—… ì €ì¥ì†Œ"}),e.jsx("select",{id:"cloud-provider",value:S,onChange:s=>W(s.target.value),disabled:N,className:"provider-select",children:R.getAvailableProviders().map(s=>e.jsxs("option",{value:s.value,children:[s.icon," ",s.label]},s.value))})]}),e.jsx("section",{className:"backup-section",children:t.isGuest&&!Z?e.jsxs("div",{className:"auth-section guest-prompt",children:[e.jsx("h3",{children:"â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”"}),e.jsxs("p",{children:[n?.providerName||"í´ë¼ìš°ë“œ ì €ì¥ì†Œ","ì— ë¡œê·¸ì¸í•˜ì—¬ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ê³ , ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ì¼ê¸°ë¥¼ ë™ê¸°í™”í•˜ì„¸ìš”."]}),e.jsxs("button",{className:"btn btn-primary clickable",onClick:V,disabled:N,children:["ğŸ” ",n?.providerName||"í´ë¼ìš°ë“œ"," ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{children:["â˜ï¸ ",n?.providerName||"í´ë¼ìš°ë“œ ì €ì¥ì†Œ"]}),Z?e.jsxs("div",{className:"authenticated-section",children:[e.jsxs("div",{className:"user-info",children:[w&&e.jsxs(e.Fragment,{children:[w.imageUrl&&e.jsx("img",{src:w.imageUrl,alt:"í”„ë¡œí•„"}),e.jsxs("div",{children:[e.jsx("div",{className:"user-name",children:w.name}),e.jsx("div",{className:"user-email",children:w.email})]})]}),e.jsx("button",{className:"btn btn-small clickable",onClick:q,children:"ë¡œê·¸ì•„ì›ƒ"})]}),e.jsxs("div",{className:"backup-actions",children:[e.jsx("button",{className:"btn btn-success clickable",onClick:J,children:"ğŸ“¤ ì§€ê¸ˆ ë°±ì—…í•˜ê¸° (ìˆ˜ë™)"}),e.jsx("button",{className:"btn btn-primary clickable",onClick:()=>D({silent:!1,isManual:!0}).then(()=>{y()}).catch(s=>{console.error("ìˆ˜ë™ ë™ê¸°í™” ì‹¤íŒ¨:",s)}),disabled:v===A.SYNCING,children:v===A.SYNCING?"ğŸ”„ ë™ê¸°í™” ì¤‘...":"ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”"}),e.jsx("button",{className:"btn btn-secondary clickable",onClick:y,disabled:N,children:"ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨"})]}),v===A.CONFLICT&&e.jsxs("div",{className:"sync-status-info conflict",children:[e.jsxs("div",{className:"conflict-header-info",children:[e.jsx("h4",{children:"âš ï¸ ë™ê¸°í™” ì¶©ëŒ"}),e.jsx("p",{children:X||"ë‹¤ë¥¸ ê¸°ê¸°ì™€ ë°ì´í„° ì¶©ëŒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})]}),e.jsx("button",{className:"btn btn-danger clickable",onClick:()=>i("ì¶©ëŒ í•´ê²° ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ìˆìŠµë‹ˆë‹¤."),children:"ì¶©ëŒ í•´ê²°í•˜ê¸°"})]}),e.jsxs("div",{className:"sync-status-info",children:[e.jsx("strong",{children:"ë™ê¸°í™” ìƒíƒœ:"})," ",e.jsx("span",{className:`status-${v.toLowerCase()}`,children:v})," ",e.jsx("br",{}),e.jsx("strong",{children:"ë§ˆì§€ë§‰ ë™ê¸°í™”:"})," ",M?new Date(M).toLocaleString():"ì—†ìŒ"]}),L>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${L}%`}}),e.jsxs("span",{className:"progress-text",children:[Math.round(L),"%"]})]}),T>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill restore",style:{width:`${T}%`}}),e.jsxs("span",{className:"progress-text",children:["ë³µì› ì¤‘... ",Math.round(T),"%"]})]}),z.length>0&&e.jsxs("div",{className:"backup-files",children:[e.jsx("h4",{children:"ë°±ì—… íŒŒì¼ ëª©ë¡"}),e.jsx("div",{className:"file-list",children:z.map((s,a)=>e.jsx(oe,{file:s,isLatest:a===0,isLoading:N,onRestore:Q,onDelete:ee},s.id))})]})]}):e.jsxs("div",{className:"auth-section",children:[e.jsxs("p",{children:[n?.providerName||"í´ë¼ìš°ë“œ ì €ì¥ì†Œ","ì— ë¡œê·¸ì¸í•˜ì—¬ ì¼ê¸°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ì„¸ìš”."]}),e.jsxs("button",{className:"btn btn-primary clickable",onClick:V,disabled:N,children:["ğŸ” ",n?.providerName||"í´ë¼ìš°ë“œ"," ë¡œê·¸ì¸"]})]})]})}),e.jsxs("section",{className:"backup-section",children:[e.jsx("h3",{children:"ğŸ’¾ ìˆ˜ë™ ë°±ì—… (ë¡œì»¬)"}),e.jsx("p",{children:"ì¼ê¸° ë°ì´í„°ë¥¼ ZIP íŒŒì¼ë¡œ ì»´í“¨í„°ì— ì €ì¥í•˜ê±°ë‚˜, ì €ì¥ëœ íŒŒì¼ì„ ë³µì›í•©ë‹ˆë‹¤."}),e.jsxs("div",{className:"manual-backup-actions",children:[e.jsx("button",{className:"btn btn-secondary clickable",onClick:se,children:"ğŸ“¥ ZIPìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°"}),e.jsxs("label",{className:"btn btn-secondary clickable",children:["ğŸ“¤ ZIP ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".zip,application/zip",style:{display:"none"},onChange:ae})]}),e.jsxs("label",{className:"btn btn-secondary clickable",children:["ğŸ“„ TXT ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".txt,text/plain",style:{display:"none"},onChange:te})]})]})]})]})]})]}):null}function ce(t){if(!t)return"0 B";const m=1024,c=["B","KB","MB","GB"],h=Math.floor(Math.log(t)/Math.log(m));return`${parseFloat((t/Math.pow(m,h)).toFixed(2))} ${c[h]}`}function le(t){return new Date(t).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function oe({file:t,isLatest:m,isLoading:c,onRestore:h,onDelete:j}){return e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"file-info",children:[e.jsxs("div",{className:"file-main-text",children:[e.jsx("span",{className:"file-date",children:le(t.createdTime)}),m&&e.jsx("span",{className:"latest-backup-badge",children:"ê°€ì¥ ìµœê·¼"})]}),e.jsxs("div",{className:"file-sub-text",children:[e.jsx("span",{className:"file-name",children:t.name})," Â· ",e.jsx("span",{className:"file-size",children:ce(t.size)})]})]}),e.jsxs("div",{className:"file-actions",children:[e.jsx("button",{className:"btn btn-small btn-primary clickable",onClick:()=>h(t.id,t.name),disabled:c,children:"ë³µì›"}),e.jsx("button",{className:"btn btn-small btn-danger clickable",onClick:()=>j(t.id,t.name),disabled:c,children:"ì‚­ì œ"})]})]})}export{fe as BackupPanel};
