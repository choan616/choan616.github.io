const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-0yaqOJfz.js","assets/vendor-ui-CGZmARxJ.js","assets/vendor-react-qkC6yhPU.js","assets/vendor-utils-BGkSQjfT.js","assets/vendor-db-CzqAUFpF.js","assets/index-M1U_o6Fo.css"])))=>i.map(i=>d[i]);
import{j as e,_ as y}from"./index-0yaqOJfz.js";import{r as g}from"./vendor-ui-CGZmARxJ.js";import{u as h}from"./vendor-db-CzqAUFpF.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-utils-BGkSQjfT.js";const u=({blob:s,alt:d})=>{const[i,l]=g.useState("");return g.useEffect(()=>{if(!s)return;const o=URL.createObjectURL(s);return l(o),()=>URL.revokeObjectURL(o)},[s]),i?e.jsx("img",{src:i,alt:d,loading:"lazy"}):e.jsx("div",{className:"gallery-image-placeholder"})};function N({userId:s,onEntryClick:d,onClose:i}){const l=h(async()=>{if(!s)return[];try{const{db:t}=await y(async()=>{const{db:a}=await import("./index-0yaqOJfz.js").then(m=>m.e);return{db:a}},__vite__mapDeps([0,1,2,3,4,5])),n=await t.images.where({userId:s}).and(a=>!a.deletedAt).toArray();if(n.length===0)return[];const r=await t.entries.where({userId:s}).and(a=>!a.deletedAt).toArray(),c=new Map(r.map(a=>[a.date,a]));return n.map(a=>({id:a.id,blob:a.thumbnail||a.blob,date:a.entryDate,title:c.get(a.entryDate)?.title||"",imageCount:1})).sort((a,m)=>new Date(m.date)-new Date(a.date))}catch(t){return console.error("Failed to load gallery items:",t),[]}},[s]),o=g.useMemo(()=>{if(!l)return{};const t={};return l.forEach(n=>{const r=new Date(n.date),c=`${r.getFullYear()}ÎÖÑ ${r.getMonth()+1}Ïõî`;t[c]||(t[c]=[]),t[c].push(n)}),t},[l]);return!l||l.length===0?e.jsxs("div",{className:"gallery-empty",children:[e.jsx("div",{className:"gallery-empty-icon",children:"üñºÔ∏è"}),e.jsx("p",{children:"ÏÇ¨ÏßÑÏù¥ Ìè¨Ìï®Îêú ÏùºÍ∏∞Í∞Ä ÏóÜÏäµÎãàÎã§."}),e.jsx("button",{className:"btn-back-diary",onClick:i,children:"ÏùºÍ∏∞ Ïì∞Îü¨ Í∞ÄÍ∏∞"})]}):e.jsxs("div",{className:"image-gallery-container",children:[e.jsxs("div",{className:"gallery-header",children:[e.jsxs("div",{className:"gallery-title-area",children:[e.jsx("h2",{children:"ÏÇ¨ÏßÑ Î™®ÏïÑÎ≥¥Í∏∞"}),e.jsxs("span",{className:"gallery-count",children:["Ï¥ù ",l?l.length:0,"Ïû•"]})]}),e.jsx("button",{className:"gallery-close-btn",onClick:i,"aria-label":"Îã´Í∏∞",children:"‚úï"})]}),e.jsx("div",{className:"gallery-content",children:Object.entries(o).map(([t,n])=>e.jsxs("div",{className:"gallery-group",children:[e.jsx("h3",{className:"gallery-group-title",children:t}),e.jsx("div",{className:"gallery-grid",children:n.map(r=>e.jsx("div",{className:"gallery-item",onClick:()=>d(r.date),title:`${r.date} ÏùºÍ∏∞ Î≥¥Í∏∞`,children:e.jsx("div",{className:"gallery-image-wrapper",children:e.jsx(u,{blob:r.blob,alt:r.title})})},r.id))})]},t))})]})}export{N as ImageGallery};
