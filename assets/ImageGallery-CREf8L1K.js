const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cc4I26Of.js","assets/vendor-ui-CGZmARxJ.js","assets/vendor-react-qkC6yhPU.js","assets/vendor-utils-BGkSQjfT.js","assets/vendor-db-CzqAUFpF.js","assets/index-EjiUUcHT.css"])))=>i.map(i=>d[i]);
import{j as e,_ as y,e as h}from"./index-Cc4I26Of.js";import{r as g}from"./vendor-ui-CGZmARxJ.js";import{u as p}from"./vendor-db-CzqAUFpF.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-utils-BGkSQjfT.js";const j=({blob:s,alt:m})=>{const[c,l]=g.useState("");return g.useEffect(()=>{if(!s)return;const d=URL.createObjectURL(s);return l(d),()=>URL.revokeObjectURL(d)},[s]),c?e.jsx("img",{src:c,alt:m,loading:"lazy"}):e.jsx("div",{className:"gallery-image-placeholder"})};function w({userId:s,onEntryClick:m,onClose:c}){const l=p(async()=>{if(!s)return[];try{const{db:t}=await y(async()=>{const{db:a}=await import("./index-Cc4I26Of.js").then(i=>i.f);return{db:a}},__vite__mapDeps([0,1,2,3,4,5])),n=await t.images.where({userId:s}).and(a=>!a.deletedAt).toArray();if(n.length===0)return[];const r=await t.entries.where({userId:s}).and(a=>!a.deletedAt).toArray(),o=new Map(r.map(a=>[a.date,a]));return n.map(a=>{const i=a.thumbnail||a.blob,u=i?h(i):null;return{id:a.id,blob:u,date:a.entryDate,title:o.get(a.entryDate)?.title||"",imageCount:1}}).sort((a,i)=>new Date(i.date)-new Date(a.date))}catch(t){return console.error("Failed to load gallery items:",t),[]}},[s]),d=g.useMemo(()=>{if(!l)return{};const t={};return l.forEach(n=>{const r=new Date(n.date),o=`${r.getFullYear()}ÎÖÑ ${r.getMonth()+1}Ïõî`;t[o]||(t[o]=[]),t[o].push(n)}),t},[l]);return!l||l.length===0?e.jsxs("div",{className:"gallery-empty",children:[e.jsx("div",{className:"gallery-empty-icon",children:"üñºÔ∏è"}),e.jsx("p",{children:"ÏÇ¨ÏßÑÏù¥ Ìè¨Ìï®Îêú ÏùºÍ∏∞Í∞Ä ÏóÜÏäµÎãàÎã§."}),e.jsx("button",{className:"btn-back-diary",onClick:c,children:"ÏùºÍ∏∞ Ïì∞Îü¨ Í∞ÄÍ∏∞"})]}):e.jsxs("div",{className:"image-gallery-container",children:[e.jsxs("div",{className:"gallery-header",children:[e.jsxs("div",{className:"gallery-title-area",children:[e.jsx("h2",{children:"ÏÇ¨ÏßÑ Î™®ÏïÑÎ≥¥Í∏∞"}),e.jsxs("span",{className:"gallery-count",children:["Ï¥ù ",l?l.length:0,"Ïû•"]})]}),e.jsx("button",{className:"gallery-close-btn",onClick:c,"aria-label":"Îã´Í∏∞",children:"‚úï"})]}),e.jsx("div",{className:"gallery-content",children:Object.entries(d).map(([t,n])=>e.jsxs("div",{className:"gallery-group",children:[e.jsx("h3",{className:"gallery-group-title",children:t}),e.jsx("div",{className:"gallery-grid",children:n.map(r=>e.jsx("div",{className:"gallery-item",onClick:()=>m(r.date),title:`${r.date} ÏùºÍ∏∞ Î≥¥Í∏∞`,children:e.jsx("div",{className:"gallery-image-wrapper",children:e.jsx(j,{blob:r.blob,alt:r.title})})},r.id))})]},t))})]})}export{w as ImageGallery};
