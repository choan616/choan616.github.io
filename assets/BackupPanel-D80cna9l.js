const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CZy6vnDo.js","assets/vendor-ui-CGZmARxJ.js","assets/vendor-react-qkC6yhPU.js","assets/vendor-utils-BGkSQjfT.js","assets/vendor-db-CzqAUFpF.js","assets/index-CSaKV4iK.css"])))=>i.map(i=>d[i]);
import{u as q,a as J,g as m,j as e,S as D,_ as b}from"./index-CZy6vnDo.js";import{r as h}from"./vendor-ui-CGZmARxJ.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-db-CzqAUFpF.js";import"./vendor-utils-BGkSQjfT.js";function ce({currentUser:t,onClose:p,onDataRestored:d,onAuthenticated:x}){const[E,R]=h.useState(!0),[B,O]=h.useState(!1),[w,S]=h.useState(null),[$,C]=h.useState([]),[k,l]=h.useState(!1),[T,_]=h.useState(0),[L,A]=h.useState(0),{showToast:n}=q(),{status:j,lastSyncTime:U,lastError:Z,triggerSync:I,notifySyncSuccess:z}=J(),y=h.useCallback(async()=>{try{l(!0);let s=await m.listBackupFiles();s.sort((r,a)=>new Date(a.createdTime)-new Date(r.createdTime)),C(s)}catch(s){console.error("íŒŒì¼ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:",s),n("ë°±ì—… íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤","error")}finally{l(!1)}},[n]);h.useEffect(()=>{const s=m.onAuthChange(async r=>{if(O(r),r){const a=await m.getCurrentUser();S(a),y()}else S(null),C([])});return()=>s()},[t.userId,y]);async function F(){try{l(!0),await m.signIn();const s=await m.getCurrentUser();if(!s)throw new Error("Google ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const r="choan616@gmail.com,mywater22@gmail.com, waterchoan@gmail.com".split(",").map(f=>f.trim()).filter(Boolean);if(r.length>0&&!r.includes(s.email))throw await m.signOut(),new Error(`ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤: ${s.email}`);const{createUser:a,getUser:i}=await b(async()=>{const{createUser:f,getUser:g}=await import("./index-CZy6vnDo.js").then(v=>v.b);return{createUser:f,getUser:g}},__vite__mapDeps([0,1,2,3,4,5])),c=await a({email:s.email,name:s.name},{imageUrl:s.imageUrl}),o=await i(c);x&&x(o),n("ë¡œê·¸ì¸ ì„±ê³µ!","success")}catch(s){console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:",s),n("ë¡œê·¸ì¸ ì‹¤íŒ¨","error")}finally{l(!1)}}async function M(){try{await m.signOut(),O(!1),S(null),C([]),n("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤","info")}catch(s){console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:",s)}}async function V(){try{l(!0),_(0),n("ë°±ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");let s;const{exportUserDataAsZip:r}=await b(async()=>{const{exportUserDataAsZip:u}=await import("./index-CZy6vnDo.js").then(P=>P.b);return{exportUserDataAsZip:u}},__vite__mapDeps([0,1,2,3,4,5]));try{if(s=await r(t.userId),console.log("ë°±ì—… ZIP íŒŒì¼ ìƒì„± ì™„ë£Œ. í¬ê¸°:",s.size),s.size<22){n("ë°±ì—…í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.","info"),l(!1);return}}catch(u){throw console.error("ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",u),new Error(`ë°ì´í„° ìƒì„± ì‹¤íŒ¨: ${u.message}`)}const{getLocalDataSummary:a}=await b(async()=>{const{getLocalDataSummary:u}=await import("./index-CZy6vnDo.js").then(P=>P.b);return{getLocalDataSummary:u}},__vite__mapDeps([0,1,2,3,4,5])),i=await a(t.userId),c=await s.arrayBuffer(),o=await crypto.subtle.digest("SHA-256",c),g=Array.from(new Uint8Array(o)).map(u=>u.toString(16).padStart(2,"0")).join(""),v={...i,contentHash:g},G=await m.syncToGoogleDrive(s,v,u=>_(u));_(100),n(`ë°±ì—… ì™„ë£Œ: ${G.file.name}`,"success"),await z(G),await y()}catch(s){console.error("ë°±ì—… ì˜¤ë¥˜:",s),n(`ë°±ì—… ì‹¤íŒ¨: ${s.message}`,"error")}finally{l(!1),_(0)}}async function H(s,r){if(confirm(`"${r}"ì„(ë¥¼) ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

í´ë¼ìš°ë“œì˜ ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`))try{l(!0),A(0),n("ë³µì›ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");const a=await m.restoreFromGoogleDrive(s);if(!a||!a.blob)throw new Error("Google Driveì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");const i=await a.blob.arrayBuffer(),{importUserData:c}=await b(async()=>{const{importUserData:o}=await import("./index-CZy6vnDo.js").then(f=>f.b);return{importUserData:o}},__vite__mapDeps([0,1,2,3,4,5]));await c(t.userId,i,!0),A(100),n("ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.","success"),(j===D.CONFLICT||d)&&(console.log("ì¶©ëŒ í•´ê²°(Pull) ë˜ëŠ” ë°ì´í„° ë³µì› í›„ ë™ê¸°í™” ìƒíƒœë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤."),I({silent:!0,isManual:!0})),setTimeout(()=>{N()},500)}catch(a){console.error("ë³µì› ì˜¤ë¥˜:",a),n(`ë³µì› ì‹¤íŒ¨: ${a.message}`,"error")}finally{l(!1),A(0)}}async function K(s,r){if(confirm(`"${r}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){l(!0);try{await m.deleteBackupFile(s),n("ë°±ì—… íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤","success"),await y()}catch(a){console.error("ì‚­ì œ ì˜¤ë¥˜:",a),n("ì‚­ì œ ì‹¤íŒ¨","error")}finally{l(!1)}}}async function X(){try{const{exportUserDataAsZip:s}=await b(async()=>{const{exportUserDataAsZip:c}=await import("./index-CZy6vnDo.js").then(o=>o.b);return{exportUserDataAsZip:c}},__vite__mapDeps([0,1,2,3,4,5])),r=await s(t.userId),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=`diary_backup_${t.email}_${new Date().toISOString().split("T")[0]}.zip`,i.click(),URL.revokeObjectURL(a),n("ZIP íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ","success")}catch(s){console.error("ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",s),n("ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨","error")}}async function Y(s){const r=s.target.files[0];if(r){if(!confirm(`'${r.name}' íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`)){s.target.value="";return}try{const{importUserData:a}=await b(async()=>{const{importUserData:c}=await import("./index-CZy6vnDo.js").then(o=>o.b);return{importUserData:c}},__vite__mapDeps([0,1,2,3,4,5])),i=await r.arrayBuffer();await a(t.userId,i,!0),n("ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.","success"),d&&d(),I&&I({silent:!1}),N()}catch(a){console.error("ZIP ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",a),n(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${a.message}`,"error")}s.target.value=""}}async function W(s){const r=s.target.files[0];if(r){if(!confirm(`'${r.name}' í…ìŠ¤íŠ¸ íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

íŒŒì¼ì˜ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì¼ê¸°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.`)){s.target.value="";return}try{const a=await r.text(),{parseTxtDiary:i}=await b(async()=>{const{parseTxtDiary:g}=await import("./txtDiaryParser-B3P80UsS.js");return{parseTxtDiary:g}},[]),c=i(a,t.userId);if(c.length===0){n("íŒŒì¼ì—ì„œ ìœ íš¨í•œ ì¼ê¸° ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.","warning");return}const{bulkAddEntries:o}=await b(async()=>{const{bulkAddEntries:g}=await import("./index-CZy6vnDo.js").then(v=>v.b);return{bulkAddEntries:g}},__vite__mapDeps([0,1,2,3,4,5])),f=await o(c);n(`${f}ê°œì˜ ì¼ê¸°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`,"success"),d&&d(),N()}catch(a){console.error("TXT ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",a),n(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${a.message}`,"error")}}}const N=()=>{R(!1),p&&p()};return E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"backup-panel-overlay",onClick:N}),e.jsxs("div",{className:"backup-panel",children:[e.jsxs("div",{className:"backup-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"ğŸ’¾ ë°±ì—… ë° ë™ê¸°í™”"}),e.jsxs("p",{className:"backup-user-info",children:["ì‚¬ìš©ì: ",t.name||t.email]})]}),e.jsx("button",{className:"close-btn clickable",onClick:N,children:"âœ•"})]}),e.jsxs("div",{className:"backup-content",children:[e.jsx("section",{className:"backup-section",children:t.isGuest&&!B?e.jsxs("div",{className:"auth-section guest-prompt",children:[e.jsx("h3",{children:"â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”"}),e.jsx("p",{children:"Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ê³ , ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ì¼ê¸°ë¥¼ ë™ê¸°í™”í•˜ì„¸ìš”."}),e.jsx("button",{className:"btn btn-primary clickable",onClick:F,disabled:k,children:"ğŸ” Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"â˜ï¸ Google Drive"}),B?e.jsxs("div",{className:"authenticated-section",children:[e.jsxs("div",{className:"user-info",children:[w&&e.jsxs(e.Fragment,{children:[w.imageUrl&&e.jsx("img",{src:w.imageUrl,alt:"í”„ë¡œí•„"}),e.jsxs("div",{children:[e.jsx("div",{className:"user-name",children:w.name}),e.jsx("div",{className:"user-email",children:w.email})]})]}),e.jsx("button",{className:"btn btn-small clickable",onClick:M,children:"ë¡œê·¸ì•„ì›ƒ"})]}),e.jsxs("div",{className:"backup-actions",children:[e.jsx("button",{className:"btn btn-success clickable",onClick:V,disabled:k,children:"ğŸ“¤ ì§€ê¸ˆ ë°±ì—…í•˜ê¸° (ìˆ˜ë™)"}),e.jsx("button",{className:"btn btn-primary clickable",onClick:()=>I({silent:!1,isManual:!0}).then(()=>{y()}).catch(s=>{console.error("ìˆ˜ë™ ë™ê¸°í™” ì‹¤íŒ¨:",s)}),disabled:j===D.SYNCING,children:j===D.SYNCING?"ğŸ”„ ë™ê¸°í™” ì¤‘...":"ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”"}),e.jsx("button",{className:"btn btn-secondary clickable",onClick:y,disabled:k,children:"ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨"})]}),j===D.CONFLICT&&e.jsxs("div",{className:"sync-status-info conflict",children:[e.jsxs("div",{className:"conflict-header-info",children:[e.jsx("h4",{children:"âš ï¸ ë™ê¸°í™” ì¶©ëŒ"}),e.jsx("p",{children:Z||"ë‹¤ë¥¸ ê¸°ê¸°ì™€ ë°ì´í„° ì¶©ëŒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})]}),e.jsx("button",{className:"btn btn-danger clickable",onClick:()=>n("ì¶©ëŒ í•´ê²° ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ìˆìŠµë‹ˆë‹¤."),children:"ì¶©ëŒ í•´ê²°í•˜ê¸°"})]}),e.jsxs("div",{className:"sync-status-info",children:[e.jsx("strong",{children:"ë™ê¸°í™” ìƒíƒœ:"})," ",e.jsx("span",{className:`status-${j.toLowerCase()}`,children:j})," ",e.jsx("br",{}),e.jsx("strong",{children:"ë§ˆì§€ë§‰ ë™ê¸°í™”:"})," ",U?new Date(U).toLocaleString():"ì—†ìŒ"]}),T>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${T}%`}}),e.jsxs("span",{className:"progress-text",children:[Math.round(T),"%"]})]}),L>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill restore",style:{width:`${L}%`}}),e.jsxs("span",{className:"progress-text",children:["ë³µì› ì¤‘... ",Math.round(L),"%"]})]}),$.length>0&&e.jsxs("div",{className:"backup-files",children:[e.jsx("h4",{children:"ë°±ì—… íŒŒì¼ ëª©ë¡"}),e.jsx("div",{className:"file-list",children:$.map((s,r)=>e.jsx(se,{file:s,isLatest:r===0,isLoading:k,onRestore:H,onDelete:K},s.id))})]})]}):e.jsxs("div",{className:"auth-section",children:[e.jsx("p",{children:"Google Driveì— ë¡œê·¸ì¸í•˜ì—¬ ì¼ê¸°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ì„¸ìš”."}),e.jsx("button",{className:"btn btn-primary clickable",onClick:F,disabled:k,children:"ğŸ” Google ë¡œê·¸ì¸"})]})]})}),e.jsxs("section",{className:"backup-section",children:[e.jsx("h3",{children:"ğŸ’¾ ìˆ˜ë™ ë°±ì—… (ë¡œì»¬)"}),e.jsx("p",{children:"ì¼ê¸° ë°ì´í„°ë¥¼ ZIP íŒŒì¼ë¡œ ì»´í“¨í„°ì— ì €ì¥í•˜ê±°ë‚˜, ì €ì¥ëœ íŒŒì¼ì„ ë³µì›í•©ë‹ˆë‹¤."}),e.jsxs("div",{className:"manual-backup-actions",children:[e.jsx("button",{className:"btn btn-secondary clickable",onClick:X,children:"ğŸ“¥ ZIPìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°"}),e.jsxs("label",{className:"btn btn-secondary clickable",children:["ğŸ“¤ ZIP ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".zip,application/zip",style:{display:"none"},onChange:Y})]}),e.jsxs("label",{className:"btn btn-secondary clickable",children:["ğŸ“„ TXT ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".txt,text/plain",style:{display:"none"},onChange:W})]})]})]})]})]})]}):null}function Q(t){if(!t)return"0 B";const p=1024,d=["B","KB","MB","GB"],x=Math.floor(Math.log(t)/Math.log(p));return`${parseFloat((t/Math.pow(p,x)).toFixed(2))} ${d[x]}`}function ee(t){return new Date(t).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function se({file:t,isLatest:p,isLoading:d,onRestore:x,onDelete:E}){return e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"file-info",children:[e.jsxs("div",{className:"file-main-text",children:[e.jsx("span",{className:"file-date",children:ee(t.createdTime)}),p&&e.jsx("span",{className:"latest-backup-badge",children:"ê°€ì¥ ìµœê·¼"})]}),e.jsxs("div",{className:"file-sub-text",children:[e.jsx("span",{className:"file-name",children:t.name})," Â· ",e.jsx("span",{className:"file-size",children:Q(t.size)})]})]}),e.jsxs("div",{className:"file-actions",children:[e.jsx("button",{className:"btn btn-small btn-primary clickable",onClick:()=>x(t.id,t.name),disabled:d,children:"ë³µì›"}),e.jsx("button",{className:"btn btn-small btn-danger clickable",onClick:()=>E(t.id,t.name),disabled:d,children:"ì‚­ì œ"})]})]})}export{ce as BackupPanel};
