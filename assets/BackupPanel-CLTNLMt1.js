const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BN9oKpQ0.js","assets/vendor-ui-CGZmARxJ.js","assets/vendor-react-qkC6yhPU.js","assets/vendor-utils-BGkSQjfT.js","assets/vendor-db-CzqAUFpF.js","assets/index-CMj12cmD.css"])))=>i.map(i=>d[i]);
import{g as ae,u as te,a as re,j as e,C as O,S as D,_ as x}from"./index-BN9oKpQ0.js";import{r as d}from"./vendor-ui-CGZmARxJ.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-db-CzqAUFpF.js";import"./vendor-utils-BGkSQjfT.js";function he({currentUser:t,onClose:p,onDataRestored:m,onAuthenticated:b}){const[A,V]=d.useState(!0),[_,G]=d.useState(()=>localStorage.getItem("preferredCloudProvider")||"google"),[n,F]=d.useState(ae),[R,P]=d.useState(!1),[v,S]=d.useState(null),[Z,I]=d.useState([]),[w,c]=d.useState(!1),[L,C]=d.useState(0),[T,B]=d.useState(0),{showToast:i}=te(),{status:j,lastSyncTime:z,lastError:H,triggerSync:E,notifySyncSuccess:K}=re(),X=async s=>{try{c(!0),G(s),localStorage.setItem("preferredCloudProvider",s);const a=await O.getService(s);F(a),P(!1),S(null),I([])}catch(a){console.error("Failed to switch provider:",a),i("ì €ì¥ì†Œ ì „í™˜ ì‹¤íŒ¨","error")}finally{c(!1)}},y=d.useCallback(async()=>{try{c(!0);let s=await n.listBackupFiles();s.sort((a,r)=>new Date(r.createdTime)-new Date(a.createdTime)),I(s)}catch(s){console.error("íŒŒì¼ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:",s),i("ë°±ì—… íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤","error")}finally{c(!1)}},[n,i]);d.useEffect(()=>{(async()=>{const a=await O.getService(_);F(a)})()},[_]),d.useEffect(()=>{if(!n)return;const s=n.onAuthChange(async a=>{if(P(a),a){const r=await n.getCurrentUser();S(r),y()}else S(null),I([])});return!n.isAuthenticated&&t?.email&&!t.isGuest&&n.restoreSession(t.email).then(a=>{console.log(a?`Silent sign-in successful for ${n.providerName}`:`Silent sign-in failed for ${n.providerName}`)}),()=>s()},[n,t.userId,t.email,t.isGuest,y]);async function U(){try{c(!0),await n.signIn();const s=await n.getCurrentUser();if(!s)throw new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");if(_==="google"){const a="".split(",").map(f=>f.trim()).filter(Boolean);if(a.length>0&&!a.includes(s.email))throw await n.signOut(),new Error(`ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤: ${s.email}`);const{createUser:r,getUser:l}=await x(async()=>{const{createUser:f,getUser:g}=await import("./index-BN9oKpQ0.js").then(k=>k.c);return{createUser:f,getUser:g}},__vite__mapDeps([0,1,2,3,4,5])),o=await r({email:s.email,name:s.name},{imageUrl:s.imageUrl}),u=await l(o);b&&b(u)}i("ë¡œê·¸ì¸ ì„±ê³µ!","success")}catch(s){console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:",s),i("ë¡œê·¸ì¸ ì‹¤íŒ¨","error")}finally{c(!1)}}async function Y(){try{await n.signOut(),P(!1),S(null),I([]),i("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤","info")}catch(s){console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:",s)}}async function W(){try{c(!0),C(0),i("ë°±ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");let s;const{exportUserDataAsZip:a}=await x(async()=>{const{exportUserDataAsZip:h}=await import("./index-BN9oKpQ0.js").then($=>$.c);return{exportUserDataAsZip:h}},__vite__mapDeps([0,1,2,3,4,5]));try{if(s=await a(t.userId),console.log("ë°±ì—… ZIP íŒŒì¼ ìƒì„± ì™„ë£Œ. í¬ê¸°:",s.size),s.size<22){i("ë°±ì—…í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.","info"),c(!1);return}}catch(h){throw console.error("ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",h),new Error(`ë°ì´í„° ìƒì„± ì‹¤íŒ¨: ${h.message}`)}const{getLocalDataSummary:r}=await x(async()=>{const{getLocalDataSummary:h}=await import("./index-BN9oKpQ0.js").then($=>$.c);return{getLocalDataSummary:h}},__vite__mapDeps([0,1,2,3,4,5])),l=await r(t.userId),o=await s.arrayBuffer(),u=await crypto.subtle.digest("SHA-256",o),g=Array.from(new Uint8Array(u)).map(h=>h.toString(16).padStart(2,"0")).join(""),k={...l,contentHash:g},M=await n.uploadBackup(s,k,h=>C(h));C(100),i(`ë°±ì—… ì™„ë£Œ: ${M.file.name}`,"success"),await K(M),await y()}catch(s){console.error("ë°±ì—… ì˜¤ë¥˜:",s),i(`ë°±ì—… ì‹¤íŒ¨: ${s.message}`,"error")}finally{c(!1),C(0)}}async function q(s,a){if(confirm(`"${a}"ì„(ë¥¼) ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

í´ë¼ìš°ë“œì˜ ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`))try{c(!0),B(0),i("ë³µì›ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");const r=await n.downloadBackup(s);if(!r||!r.blob)throw new Error("Google Driveì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");const l=await r.blob.arrayBuffer(),{importUserData:o}=await x(async()=>{const{importUserData:u}=await import("./index-BN9oKpQ0.js").then(f=>f.c);return{importUserData:u}},__vite__mapDeps([0,1,2,3,4,5]));await o(t.userId,l,!0),B(100),i("ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.","success"),(j===D.CONFLICT||m)&&(console.log("ì¶©ëŒ í•´ê²°(Pull) ë˜ëŠ” ë°ì´í„° ë³µì› í›„ ë™ê¸°í™” ìƒíƒœë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤."),E({silent:!0,isManual:!0})),setTimeout(()=>{N()},500)}catch(r){console.error("ë³µì› ì˜¤ë¥˜:",r),i(`ë³µì› ì‹¤íŒ¨: ${r.message}`,"error")}finally{c(!1),B(0)}}async function J(s,a){if(confirm(`"${a}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){c(!0);try{await n.deleteBackup(s),i("ë°±ì—… íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤","success"),await y()}catch(r){console.error("ì‚­ì œ ì˜¤ë¥˜:",r),i("ì‚­ì œ ì‹¤íŒ¨","error")}finally{c(!1)}}}async function Q(){try{const{exportUserDataAsZip:s}=await x(async()=>{const{exportUserDataAsZip:o}=await import("./index-BN9oKpQ0.js").then(u=>u.c);return{exportUserDataAsZip:o}},__vite__mapDeps([0,1,2,3,4,5])),a=await s(t.userId),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=`diary_backup_${t.email}_${new Date().toISOString().split("T")[0]}.zip`,l.click(),URL.revokeObjectURL(r),i("ZIP íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ","success")}catch(s){console.error("ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:",s),i("ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨","error")}}async function ee(s){const a=s.target.files[0];if(a){if(!confirm(`'${a.name}' íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

ë°ì´í„°ê°€ í˜„ì¬ ê¸°ê¸°ì— ë³‘í•©ë©ë‹ˆë‹¤.`)){s.target.value="";return}try{const{importUserData:r}=await x(async()=>{const{importUserData:o}=await import("./index-BN9oKpQ0.js").then(u=>u.c);return{importUserData:o}},__vite__mapDeps([0,1,2,3,4,5])),l=await a.arrayBuffer();await r(t.userId,l,!0),i("ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.","success"),m&&m(),E&&E({silent:!1}),N()}catch(r){console.error("ZIP ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",r),i(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${r.message}`,"error")}s.target.value=""}}async function se(s){const a=s.target.files[0];if(a){if(!confirm(`'${a.name}' í…ìŠ¤íŠ¸ íŒŒì¼ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?

íŒŒì¼ì˜ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì¼ê¸°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.`)){s.target.value="";return}try{const r=await a.text(),{parseTxtDiary:l}=await x(async()=>{const{parseTxtDiary:g}=await import("./txtDiaryParser-B3P80UsS.js");return{parseTxtDiary:g}},[]),o=l(r,t.userId);if(o.length===0){i("íŒŒì¼ì—ì„œ ìœ íš¨í•œ ì¼ê¸° ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.","warning");return}const{bulkAddEntries:u}=await x(async()=>{const{bulkAddEntries:g}=await import("./index-BN9oKpQ0.js").then(k=>k.c);return{bulkAddEntries:g}},__vite__mapDeps([0,1,2,3,4,5])),f=await u(o);i(`${f}ê°œì˜ ì¼ê¸°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`,"success"),m&&m(),N()}catch(r){console.error("TXT ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:",r),i(`ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${r.message}`,"error")}}}const N=()=>{V(!1),p&&p()};return A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"backup-panel-overlay",onClick:N}),e.jsxs("div",{className:"backup-panel",children:[e.jsxs("div",{className:"backup-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"ğŸ’¾ ë°±ì—… ë° ë™ê¸°í™”"}),e.jsxs("p",{className:"backup-user-info",children:["ì‚¬ìš©ì: ",t.name||t.email]})]}),e.jsx("button",{className:"close-btn clickable",onClick:N,children:"âœ•"})]}),e.jsxs("div",{className:"backup-content",children:[e.jsxs("div",{className:"provider-selector",children:[e.jsx("label",{htmlFor:"cloud-provider",children:"ë°±ì—… ì €ì¥ì†Œ"}),e.jsx("select",{id:"cloud-provider",value:_,onChange:s=>X(s.target.value),disabled:w,className:"provider-select",children:O.getAvailableProviders().map(s=>e.jsxs("option",{value:s.value,children:[s.icon," ",s.label]},s.value))})]}),e.jsx("section",{className:"backup-section",children:t.isGuest&&!R?e.jsxs("div",{className:"auth-section guest-prompt",children:[e.jsx("h3",{children:"â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”"}),e.jsxs("p",{children:[n?.providerName||"í´ë¼ìš°ë“œ ì €ì¥ì†Œ","ì— ë¡œê·¸ì¸í•˜ì—¬ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ê³ , ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ì¼ê¸°ë¥¼ ë™ê¸°í™”í•˜ì„¸ìš”."]}),e.jsxs("button",{className:"btn btn-primary clickable",onClick:U,disabled:w,children:["ğŸ” ",n?.providerName||"í´ë¼ìš°ë“œ"," ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{children:["â˜ï¸ ",n?.providerName||"í´ë¼ìš°ë“œ ì €ì¥ì†Œ"]}),R?e.jsxs("div",{className:"authenticated-section",children:[e.jsxs("div",{className:"user-info",children:[v&&e.jsxs(e.Fragment,{children:[v.imageUrl&&e.jsx("img",{src:v.imageUrl,alt:"í”„ë¡œí•„"}),e.jsxs("div",{children:[e.jsx("div",{className:"user-name",children:v.name}),e.jsx("div",{className:"user-email",children:v.email})]})]}),e.jsx("button",{className:"btn btn-small clickable",onClick:Y,children:"ë¡œê·¸ì•„ì›ƒ"})]}),e.jsxs("div",{className:"backup-actions",children:[e.jsx("button",{className:"btn btn-success clickable",onClick:W,children:"ğŸ“¤ ì§€ê¸ˆ ë°±ì—…í•˜ê¸° (ìˆ˜ë™)"}),e.jsx("button",{className:"btn btn-primary clickable",onClick:()=>E({silent:!1,isManual:!0}).then(()=>{y()}).catch(s=>{console.error("ìˆ˜ë™ ë™ê¸°í™” ì‹¤íŒ¨:",s)}),disabled:j===D.SYNCING,children:j===D.SYNCING?"ğŸ”„ ë™ê¸°í™” ì¤‘...":"ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”"}),e.jsx("button",{className:"btn btn-secondary clickable",onClick:y,disabled:w,children:"ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨"})]}),j===D.CONFLICT&&e.jsxs("div",{className:"sync-status-info conflict",children:[e.jsxs("div",{className:"conflict-header-info",children:[e.jsx("h4",{children:"âš ï¸ ë™ê¸°í™” ì¶©ëŒ"}),e.jsx("p",{children:H||"ë‹¤ë¥¸ ê¸°ê¸°ì™€ ë°ì´í„° ì¶©ëŒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})]}),e.jsx("button",{className:"btn btn-danger clickable",onClick:()=>i("ì¶©ëŒ í•´ê²° ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ìˆìŠµë‹ˆë‹¤."),children:"ì¶©ëŒ í•´ê²°í•˜ê¸°"})]}),e.jsxs("div",{className:"sync-status-info",children:[e.jsx("strong",{children:"ë™ê¸°í™” ìƒíƒœ:"})," ",e.jsx("span",{className:`status-${j.toLowerCase()}`,children:j})," ",e.jsx("br",{}),e.jsx("strong",{children:"ë§ˆì§€ë§‰ ë™ê¸°í™”:"})," ",z?new Date(z).toLocaleString():"ì—†ìŒ"]}),L>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${L}%`}}),e.jsxs("span",{className:"progress-text",children:[Math.round(L),"%"]})]}),T>0&&e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill restore",style:{width:`${T}%`}}),e.jsxs("span",{className:"progress-text",children:["ë³µì› ì¤‘... ",Math.round(T),"%"]})]}),Z.length>0&&e.jsxs("div",{className:"backup-files",children:[e.jsx("h4",{children:"ë°±ì—… íŒŒì¼ ëª©ë¡"}),e.jsx("div",{className:"file-list",children:Z.map((s,a)=>e.jsx(ce,{file:s,isLatest:a===0,isLoading:w,onRestore:q,onDelete:J},s.id))})]})]}):e.jsxs("div",{className:"auth-section",children:[e.jsxs("p",{children:[n?.providerName||"í´ë¼ìš°ë“œ ì €ì¥ì†Œ","ì— ë¡œê·¸ì¸í•˜ì—¬ ì¼ê¸°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ì„¸ìš”."]}),e.jsxs("button",{className:"btn btn-primary clickable",onClick:U,disabled:w,children:["ğŸ” ",n?.providerName||"í´ë¼ìš°ë“œ"," ë¡œê·¸ì¸"]})]})]})}),e.jsxs("section",{className:"backup-section",children:[e.jsx("h3",{children:"ğŸ’¾ ìˆ˜ë™ ë°±ì—… (ë¡œì»¬)"}),e.jsx("p",{children:"ì¼ê¸° ë°ì´í„°ë¥¼ ZIP íŒŒì¼ë¡œ ì»´í“¨í„°ì— ì €ì¥í•˜ê±°ë‚˜, ì €ì¥ëœ íŒŒì¼ì„ ë³µì›í•©ë‹ˆë‹¤."}),e.jsxs("div",{className:"manual-backup-actions",children:[e.jsx("button",{className:"btn btn-secondary clickable",onClick:Q,children:"ğŸ“¥ ZIPìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°"}),e.jsxs("label",{className:"btn btn-secondary clickable",children:["ğŸ“¤ ZIP ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".zip,application/zip",style:{display:"none"},onChange:ee})]}),e.jsxs("label",{className:"btn btn-secondary clickable",children:["ğŸ“„ TXT ê°€ì ¸ì˜¤ê¸°",e.jsx("input",{type:"file",accept:".txt,text/plain",style:{display:"none"},onChange:se})]})]})]})]})]})]}):null}function ie(t){if(!t)return"0 B";const p=1024,m=["B","KB","MB","GB"],b=Math.floor(Math.log(t)/Math.log(p));return`${parseFloat((t/Math.pow(p,b)).toFixed(2))} ${m[b]}`}function ne(t){return new Date(t).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function ce({file:t,isLatest:p,isLoading:m,onRestore:b,onDelete:A}){return e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"file-info",children:[e.jsxs("div",{className:"file-main-text",children:[e.jsx("span",{className:"file-date",children:ne(t.createdTime)}),p&&e.jsx("span",{className:"latest-backup-badge",children:"ê°€ì¥ ìµœê·¼"})]}),e.jsxs("div",{className:"file-sub-text",children:[e.jsx("span",{className:"file-name",children:t.name})," Â· ",e.jsx("span",{className:"file-size",children:ie(t.size)})]})]}),e.jsxs("div",{className:"file-actions",children:[e.jsx("button",{className:"btn btn-small btn-primary clickable",onClick:()=>b(t.id,t.name),disabled:m,children:"ë³µì›"}),e.jsx("button",{className:"btn btn-small btn-danger clickable",onClick:()=>A(t.id,t.name),disabled:m,children:"ì‚­ì œ"})]})]})}export{he as BackupPanel};
